---
title: "Project 1 LDA Prova"
author: "Daniele Capelli"
date: "2025-10-22"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Exploratory Data Analysis in R

Start by analyzing data...

```{r libraries}
library(haven)
library(sas7bdat)
library(ggplot2)
library(tidyr)
library(dplyr)
library(GGally)
library(corrplot)
alz <- read_sas("C:/Users/Daniele/Desktop/2025 - 26 Primo Semestre/Longitudinal Data Analysis/Project 1 Alzheimer LDA/alzheimer25.sas7bdat")
#alz <- read.csv("C:/Users/Daniele/Desktop/2025 - 26 Primo Semestre/Longitudinal Data Analysis/Project 1 Alzheimer LDA/alzheimer25.csv")

head(alz)
summary(alz)

alz$trial <- as.factor(alz$trial)
alz$sex <- as.factor(alz$sex)
alz$edu <- as.factor(alz$edu)
alz$job <- as.factor(alz$job)
alz$wzc <- as.factor(alz$wzc)

summary(alz)
```

Then create the longitudinal data frame.

```{r dataframe}
alz_df <- data.frame(alz)

alz_long <- alz_df %>%
  pivot_longer(
    # 1️⃣ Seleziona tutte le colonne che iniziano con cdrsb, abpet o taupet,
    #     seguite da un numero (0–6)
    cols = matches("^(bprs|cdrsb|abpet|taupet)\\d+$"),
    
    # 2️⃣ Crea due nuove colonne:
    #     - ".value" → il prefisso (cdrsb, abpet, taupet)
    #     - "year"   → il numero alla fine
    names_to = c(".value", "year"),
    
    # 3️⃣ Divide i nomi in due parti: (prefisso, numero)
    names_pattern = "(bprs|cdrsb|abpet|taupet)(\\d+)"
  ) %>%
  mutate(
    year = as.numeric(year),                            # converte in numerico
    sample = factor(rep(1:nrow(alz_df), each = 7)) # ID per ogni paziente
  )
```

Discretize the quantitative variables (it is useful later on).

```{r continuous vars bins}
## Maybe any 5 years?
alz_long$age_disc <- (alz_long$age %/% 5) * 5
alz_long$age_disc <- as.factor(alz_long$age_disc)

## bmi any 4
alz_long$bmi_disc <- (alz_long$bmi %/% 4) * 4
alz_long$bmi_disc <- as.factor(alz_long$bmi_disc)

## inkomen any 500
alz_long$inkomen_disc <- (alz_long$inkomen %/% 500) * 500
alz_long$inkomen_disc <- as.factor(alz_long$inkomen_disc)

## adl any 5
alz_long$adl_disc <- (alz_long$adl %/% 5) * 5
alz_long$adl_disc <- as.factor(alz_long$adl_disc)

## cdrsb any 5
alz_long$cdrsb_disc <- (alz_long$cdrsb %/% 5) * 5
alz_long$cdrsb_disc <- as.factor(alz_long$cdrsb_disc)

## abpet any 0.2
alz_long$abpet_disc <- (alz_long$abpet %/% 0.2) * 0.2
alz_long$abpet_disc <- as.factor(alz_long$abpet_disc)

## taupet any 0.2
alz_long$taupet_disc <- (alz_long$taupet %/% 0.2) * 0.2
alz_long$taupet_disc <- as.factor(alz_long$taupet_disc)
```

Now create a restricted version to work on for simplicity in certain cases (it is too long to compute everything I will fix it later on if we need it).

```{r rist datates}
casual <- sample(1:length(alz$patid), 50)

## Now we can start by looking at random values for the mean and see
## if we can work on the mean and so on

alz_rist <- alz[casual, ]
alz_rist_df <- data.frame(alz_rist)

alz_rist_long <- alz_rist_df %>%
  pivot_longer(
    # 1️⃣ Seleziona tutte le colonne che iniziano con cdrsb, abpet o taupet,
    #     seguite da un numero (0–6)
    cols = matches("^(bprs|cdrsb|abpet|taupet)\\d+$"),
    
    # 2️⃣ Crea due nuove colonne:
    #     - ".value" → il prefisso (cdrsb, abpet, taupet)
    #     - "year"   → il numero alla fine
    names_to = c(".value", "year"),
    
    # 3️⃣ Divide i nomi in due parti: (prefisso, numero)
    names_pattern = "(bprs|cdrsb|abpet|taupet)(\\d+)"
  ) %>%
  mutate(
    year = as.numeric(year),                            # converte in numerico
    sample = factor(rep(1:nrow(alz_rist_df), each = 7)) # ID per ogni paziente
  )
```

Finally start to look at visual representations.

```{r sample visualization restricted}
ggplot(alz_rist_long, aes(x = year, y = bprs, group = patid, 
                                color = sample, show.legend = FALSE)) + 
  geom_line(alpha = 0.5, show.legend = FALSE) +
  theme_bw() +
  labs(title = "BPRS against year of measuring")

ggplot(alz_rist_long, aes(x = year, y = cdrsb, group = patid, 
                                color = sample, show.legend = FALSE)) + 
  geom_line(alpha = 0.5, show.legend = FALSE) +
  theme_bw() +
  labs(title = "CDRSB against year of measuring")


ggplot(alz_rist_long, aes(x = year, y = abpet, group = patid, 
                                color = sample, show.legend = FALSE)) + 
  geom_line(alpha = 0.5, show.legend = FALSE) +
  theme_bw() +
  labs(title = "ABPET against year of measuring")

ggplot(alz_rist_long, aes(x = year, y = taupet, group = patid, 
                          color = sample, show.legend = FALSE)) + 
  geom_line(alpha = 0.5, show.legend = FALSE) +
  theme_bw() +
  labs(title = "TAUPET against year of measuring")
```

Maybe we should analyze how many missing data we have??

Now try to estimate average behavior in different groups.

```{r general mean}
## General behavior
ggplot(alz_long, aes(x = year, y = bprs)) +
  stat_summary(fun = mean, geom = "line", size = 1) +
  stat_summary(fun.data = mean_sdl, geom = "ribbon", fun.args = list(mult = 1),
               alpha = 0.2, fill = "lightblue") +
  theme_minimal() +
  labs(title = "General mean behavior")

ggplot(alz_long, aes(x = year, y = bprs, group = sex, color = sex)) +
  stat_summary(fun = mean, geom = "line", size = 1) +
  stat_summary(fun.data = mean_sdl, geom = "ribbon", fun.args = list(mult = 1),
               alpha = 0.2, fill = "lightblue") +
  theme_minimal() +
  labs(title = "General mean behavior wrt sex")

ggplot(alz_long, aes(x = year, y = bprs, group = trial, color = trial)) +
  stat_summary(fun = mean, geom = "line", size = 1) +
  stat_summary(fun.data = mean_sdl, geom = "ribbon", fun.args = list(mult = 1),
               alpha = 0.2, fill = "lightblue") +
  theme_minimal() +
  labs(title = "General mean behavior wrt trial")

ggplot(alz_long, aes(x = year, y = bprs, group = trial, color = trial)) +
  stat_summary(fun = mean, geom = "line", size = 1) +
  #stat_summary(fun.data = mean_sdl, geom = "ribbon", fun.args = list(mult = 1),
  #             alpha = 0.2, fill = "lightblue") +
  theme_minimal() +
  labs(title = "General mean behavior wrt trial without variance")

ggplot(alz_long, aes(x = year, y = bprs, group = age, color = age)) +
  stat_summary(fun = mean, geom = "line", size = 1) +
  stat_summary(fun.data = mean_sdl, geom = "ribbon", fun.args = list(mult = 1),
               alpha = 0.2, fill = "lightblue") +
  theme_minimal() +
  labs(title = "General mean behavior wrt age")

ggplot(alz_long, aes(x = year, y = bprs, group = age, color = age)) +
  stat_summary(fun = mean, geom = "line", size = 1) +
  #stat_summary(fun.data = mean_sdl, geom = "ribbon", fun.args = list(mult = 1),
  #             alpha = 0.2, fill = "lightblue") +
  theme_minimal() +
  labs(title = "General mean behavior wrt age without variance")

ggplot(alz_long, aes(x = year, y = bprs, group = edu, color = edu)) +
  stat_summary(fun = mean, geom = "line", size = 1) +
  stat_summary(fun.data = mean_sdl, geom = "ribbon", fun.args = list(mult = 1),
               alpha = 0.2, fill = "lightblue") +
  theme_minimal() +
  labs(title = "General mean behavior wrt edu")

ggplot(alz_long, aes(x = year, y = bprs, group = bmi, color = bmi)) +
  stat_summary(fun = mean, geom = "line", size = 1) +
  stat_summary(fun.data = mean_sdl, geom = "ribbon", fun.args = list(mult = 1),
               alpha = 0.2, fill = "lightblue") +
  theme_minimal() +
  labs(title = "General mean behavior wrt bmi")

ggplot(alz_long, aes(x = year, y = bprs, group = bmi, color = bmi)) +
  stat_summary(fun = mean, geom = "line", size = 1) +
  #stat_summary(fun.data = mean_sdl, geom = "ribbon", fun.args = list(mult = 1),
  #             alpha = 0.2, fill = "lightblue") +
  theme_minimal() +
  labs(title = "General mean behavior wrt bmi without variance")

ggplot(alz_long, aes(x = year, y = bprs, group = inkomen, color = inkomen)) +
  stat_summary(fun = mean, geom = "line", size = 1) +
  stat_summary(fun.data = mean_sdl, geom = "ribbon", fun.args = list(mult = 1),
               alpha = 0.2, fill = "lightblue") +
  theme_minimal() +
  labs(title = "General mean behavior wrt inkomen")

ggplot(alz_long, aes(x = year, y = bprs, group = inkomen, color = inkomen)) +
  stat_summary(fun = mean, geom = "line", size = 1) +
  #stat_summary(fun.data = mean_sdl, geom = "ribbon", fun.args = list(mult = 1),
  #             alpha = 0.2, fill = "lightblue") +
  theme_minimal() +
  labs(title = "General mean behavior wrt inkomen without variance")

ggplot(alz_long, aes(x = year, y = bprs, group = job, color = job)) +
  stat_summary(fun = mean, geom = "line", size = 1) +
  stat_summary(fun.data = mean_sdl, geom = "ribbon", fun.args = list(mult = 1),
               alpha = 0.2, fill = "lightblue") +
  theme_minimal() +
  labs(title = "General mean behavior wrt job")

ggplot(alz_long, aes(x = year, y = bprs, group = adl, color = adl)) +
  stat_summary(fun = mean, geom = "line", size = 1) +
  stat_summary(fun.data = mean_sdl, geom = "ribbon", fun.args = list(mult = 1),
               alpha = 0.2, fill = "lightblue") +
  theme_minimal() +
  labs(title = "General mean behavior wrt adl")

ggplot(alz_long, aes(x = year, y = bprs, group = wzc, color = wzc)) +
  stat_summary(fun = mean, geom = "line", size = 1) +
  stat_summary(fun.data = mean_sdl, geom = "ribbon", fun.args = list(mult = 1),
               alpha = 0.2, fill = "lightblue") +
  theme_minimal() +
  labs(title = "General mean behavior wrt wzc")

```

_NOTA PERSONALE: con questo codice ggplot mostra una stima puntuale della deviazione standard, non della varianza, ma penso vada comunque bene? Prova a chiedere agli altri nel caso si sistema subito_

From the general mean behavior it seems that over the years the bprs value increases in a linear way. In addition it seems that the estimated variance among the years is more or less constant (so we can apply the variogram procedure??).

Speaking of the categorical variables, it seems to me that there are significant differences between groups speaking of sex (but not particularly marked), job and wzc. The variable edu seems to be not of particular interest?

Now we also have a look at the biological indicators (but maybe we will discretize them later on which is more significant).

```{r biomarker}
ggplot(alz_long, aes(x = year, y = bprs, group = cdrsb, color = cdrsb)) +
  stat_summary(fun = mean, geom = "line", size = 1) +
  stat_summary(fun.data = mean_sdl, geom = "ribbon", fun.args = list(mult = 1),
               alpha = 0.2, fill = "lightblue") +
  theme_minimal() +
  labs(title = "General mean behavior wrt cdrsb")

ggplot(alz_long, aes(x = year, y = bprs, group = cdrsb, color = cdrsb)) +
  stat_summary(fun = mean, geom = "line", size = 1) +
  #stat_summary(fun.data = mean_sdl, geom = "ribbon", fun.args = list(mult = 1),
  #             alpha = 0.2, fill = "lightblue") +
  theme_minimal() +
  labs(title = "General mean behavior wrt cbrs without variance")

ggplot(alz_long, aes(x = year, y = bprs, group = abpet, color = abpet)) +
  stat_summary(fun = mean, geom = "line", size = 1) +
  stat_summary(fun.data = mean_sdl, geom = "ribbon", fun.args = list(mult = 1),
               alpha = 0.2, fill = "lightblue") +
  theme_minimal() +
  labs(title = "General mean behavior wrt abpet")

ggplot(alz_long, aes(x = year, y = bprs, group = abpet, color = abpet)) +
  stat_summary(fun = mean, geom = "line", size = 1) +
  #stat_summary(fun.data = mean_sdl, geom = "ribbon", fun.args = list(mult = 1),
  #             alpha = 0.2, fill = "lightblue") +
  theme_minimal() +
  labs(title = "General mean behavior wrt abpet without variance")

ggplot(alz_long, aes(x = year, y = bprs, group = taupet, color = taupet)) +
  stat_summary(fun = mean, geom = "line", size = 1) +
  stat_summary(fun.data = mean_sdl, geom = "ribbon", fun.args = list(mult = 1),
               alpha = 0.2, fill = "lightblue") +
  theme_minimal() +
  labs(title = "General mean behavior wrt taupet")

ggplot(alz_long, aes(x = year, y = bprs, group = taupet, color = taupet)) +
  stat_summary(fun = mean, geom = "line", size = 1) +
  #stat_summary(fun.data = mean_sdl, geom = "ribbon", fun.args = list(mult = 1),
  #             alpha = 0.2, fill = "lightblue") +
  theme_minimal() +
  labs(title = "General mean behavior wrt taupet without variance")
```

Not that understandable.

Maybe we should discretize the continuous variables inside bins to see if there are significant differences. Should we consider the trial??


```{r mean quant vars}
ggplot(alz_long, aes(x = year, y = bprs, group = age_disc, color = age_disc)) +
  stat_summary(fun = mean, geom = "line", size = 1) +
  #stat_summary(fun.data = mean_sdl, geom = "ribbon", fun.args = list(mult = 1),
  #             alpha = 0.2, fill = "lightblue") +
  theme_minimal() +
  labs(title = "General mean behavior wrt age_disc without variance")

ggplot(alz_long, aes(x = year, y = bprs, group = bmi_disc, color = bmi_disc)) +
  stat_summary(fun = mean, geom = "line", size = 1) +
  #stat_summary(fun.data = mean_sdl, geom = "ribbon", fun.args = list(mult = 1),
  #             alpha = 0.2, fill = "lightblue") +
  theme_minimal() +
  labs(title = "General mean behavior wrt bmi_disc without variance")

ggplot(alz_long, aes(x = year, y = bprs, group = inkomen_disc, color = inkomen_disc)) +
  stat_summary(fun = mean, geom = "line", size = 1) +
  #stat_summary(fun.data = mean_sdl, geom = "ribbon", fun.args = list(mult = 1),
  #             alpha = 0.2, fill = "lightblue") +
  theme_minimal() +
  labs(title = "General mean behavior wrt inkomen_disc without variance")

ggplot(alz_long, aes(x = year, y = bprs, group = adl_disc, color = adl_disc)) +
  stat_summary(fun = mean, geom = "line", size = 1) +
  #stat_summary(fun.data = mean_sdl, geom = "ribbon", fun.args = list(mult = 1),
  #             alpha = 0.2, fill = "lightblue") +
  theme_minimal() +
  labs(title = "General mean behavior wrt adl_disc without variance")

ggplot(alz_long, aes(x = year, y = bprs, group = cdrsb_disc, color = cdrsb_disc)) +
  stat_summary(fun = mean, geom = "line", size = 1) +
  #stat_summary(fun.data = mean_sdl, geom = "ribbon", fun.args = list(mult = 1),
  #             alpha = 0.2, fill = "lightblue") +
  theme_minimal() +
  labs(title = "General mean behavior wrt cdrsb_disc without variance")

ggplot(alz_long, aes(x = year, y = bprs, group = abpet_disc, color = abpet_disc)) +
  stat_summary(fun = mean, geom = "line", size = 1) +
  #stat_summary(fun.data = mean_sdl, geom = "ribbon", fun.args = list(mult = 1),
  #             alpha = 0.2, fill = "lightblue") +
  theme_minimal() +
  labs(title = "General mean behavior wrt abpet_disc without variance")

ggplot(alz_long, aes(x = year, y = bprs, group = taupet_disc, color = taupet_disc)) +
  stat_summary(fun = mean, geom = "line", size = 1) +
  #stat_summary(fun.data = mean_sdl, geom = "ribbon", fun.args = list(mult = 1),
  #             alpha = 0.2, fill = "lightblue") +
  theme_minimal() +
  labs(title = "General mean behavior wrt taupet_disc without variance")
```

Here we have more interesting results. It seems that the slopes stays the same over the different groups but the baselines are different, this could be interest. We should study this in a better way.


## Visual representation of the paired data and correlations

Just to speed up the computations it is better to use the restricted dataset.

```{r ggpairs}
ggpairs(alz_rist_long, columns = c(3:15))
```

Speaking of bprs (the variable we are interested in) it seems that it is correlated more to age, adl, inkomen (not that muche), maybe edu (but it doesn't seem like the case), wzc, year (definitely), abpet (and somehow also to the other two biomarkers). But we should investigate this better.

Just to be complete.

```{r pairs}
pairs(alz_rist_long[, c(3:15)])
```

## Correlation matrix

_We could do it with the corrplot library? Don't know maybe later on_


# Summary Statistics (da approfondire meglio idee base forse ci sono)

Now we want to have a look at some possible summary statistics. The ones proposed during the lectures are:
- analysis at each time point: could be interesting
- analysis of area under the curve: doesn't seem particularly interesting
- analysis of endpoints: don't know it doesn't take into consideration possible differences in the baseline and in addition not every patient is up to 6 years of measurements
- analysis of increments: interesting
- analysis of covariance: _non ho capito come funziona_


## Analysis time points

We can analyze each time separately (we have six of them). We could start from time point 0? Should it make sense?

### Time point 0

Should we try a linear regression? Should we try in a different way?

```{r time point 0}
mod_tp_0 <- lm(bprs0 ~ sex + age + edu + bmi +
                 inkomen + job + adl + wzc + cdrsb0 + abpet0 + taupet0,
               data = alz)

summary(mod_tp_0)
```

Then we can analyze these results? We can get the significant variables? I don't know if there is anything else that could be interesting.

Should we try something different?

### Time point 1

Should we try a linear regression? Should we try in a different way?

```{r time point 1}
mod_tp_1 <- lm(bprs1 ~ sex + age + edu + bmi +
                 inkomen + job + adl + wzc + cdrsb1 + abpet1 + taupet1,
               data = alz)

summary(mod_tp_1)
```

Should we compare the results with other time points?

### Time point 2

Should we try a linear regression? Should we try in a different way?

```{r time point 2}
mod_tp_2 <- lm(bprs2 ~ sex + age + edu + bmi +
                 inkomen + job + adl + wzc + cdrsb2 + abpet2 + taupet2,
               data = alz)

summary(mod_tp_2)
```

### Time point 3

Should we try a linear regression? Should we try in a different way?

```{r time point 3}
mod_tp_3 <- lm(bprs3 ~ sex + age + edu + bmi +
                 inkomen + job + adl + wzc + cdrsb3 + abpet3 + taupet3,
               data = alz)

summary(mod_tp_3)
```

### Time point 4

Should we try a linear regression? Should we try in a different way?

```{r time point 4}
mod_tp_4 <- lm(bprs4 ~ sex + age + edu + bmi +
                 inkomen + job + adl + wzc + cdrsb4 + abpet4 + taupet4,
               data = alz)

summary(mod_tp_4)
```

### Time point 5

Should we try a linear regression? Should we try in a different way?

```{r time point 5}
mod_tp_5 <- lm(bprs5 ~ sex + age + edu + bmi +
                 inkomen + job + adl + wzc + cdrsb5 + abpet5 + taupet5,
               data = alz)

summary(mod_tp_5)
```

### Time point 6

Should we try a linear regression? Should we try in a different way?

```{r time point 6}
mod_tp_6 <- lm(bprs6 ~ sex + age + edu + bmi +
                 inkomen + job + adl + wzc + cdrsb6 + abpet6 + taupet6,
               data = alz)

summary(mod_tp_6)
```


It seems that the $R^2$ value is decreasing over time to me. In addition we could analyze the different values of the parameter? I don't know...



## Analysis of endpoints

Probably it is better to look at the baseline values before going on with the analysis of endpoints.

```{r hist}
hist(alz$bprs0)
hist(alz$cdrsb0)
hist(alz$abpet0)
hist(alz$taupet0)
```

The values are not exactly the same so I don't know if it could work. In addition we don't have the same endpoints? How could it work?
Also we need to fix a little bit the data set (add the last biomarker measurement...)

## Analysis of increments (da migliorare un po' ma idea base ci dovrebbe essere)

We need to play with our dataset. We can create a new one because it is easier.

```{r increments dataset}
alz_inc <- alz

# Compute the increments
alz_inc$cdrsbinc0 <- rep(0, length(alz_inc$patid))
alz_inc$cdrsbinc1 <- alz_inc$cdrsb1 - alz_inc$cdrsb0
alz_inc$cdrsbinc2 <- alz_inc$cdrsb2 - alz_inc$cdrsb0
alz_inc$cdrsbinc3 <- alz_inc$cdrsb3 - alz_inc$cdrsb0
alz_inc$cdrsbinc4 <- alz_inc$cdrsb4 - alz_inc$cdrsb0
alz_inc$cdrsbinc5 <- alz_inc$cdrsb5 - alz_inc$cdrsb0
alz_inc$cdrsbinc6 <- alz_inc$cdrsb6 - alz_inc$cdrsb0

alz_inc$bprsinc0 <- rep(0, length(alz_inc$patid))
alz_inc$bprsinc1 <- alz_inc$bprs1 - alz_inc$bprs0
alz_inc$bprsinc2 <- alz_inc$bprs2 - alz_inc$bprs0
alz_inc$bprsinc3 <- alz_inc$bprs3 - alz_inc$bprs0
alz_inc$bprsinc4 <- alz_inc$bprs4 - alz_inc$bprs0
alz_inc$bprsinc5 <- alz_inc$bprs5 - alz_inc$bprs0
alz_inc$bprsinc6 <- alz_inc$bprs6 - alz_inc$bprs0

alz_inc$abpetinc0 <- rep(0, length(alz_inc$patid))
alz_inc$abpetinc1 <- alz_inc$abpet1 - alz_inc$abpet0
alz_inc$abpetinc2 <- alz_inc$abpet2 - alz_inc$abpet0
alz_inc$abpetinc3 <- alz_inc$abpet3 - alz_inc$abpet0
alz_inc$abpetinc4 <- alz_inc$abpet4 - alz_inc$abpet0
alz_inc$abpetinc5 <- alz_inc$abpet5 - alz_inc$abpet0
alz_inc$abpetinc6 <- alz_inc$abpet6 - alz_inc$abpet0

alz_inc$taupetinc0 <- rep(0, length(alz_inc$patid))
alz_inc$taupetinc1 <- alz_inc$taupet1 - alz_inc$taupet0
alz_inc$taupetinc2 <- alz_inc$taupet2 - alz_inc$taupet0
alz_inc$taupetinc3 <- alz_inc$taupet3 - alz_inc$taupet0
alz_inc$taupetinc4 <- alz_inc$taupet4 - alz_inc$taupet0
alz_inc$taupetinc5 <- alz_inc$taupet5 - alz_inc$taupet0
alz_inc$taupetinc6 <- alz_inc$taupet6 - alz_inc$taupet0

## Now go back to the dataframe structure
alz_inc_df <- data.frame(alz_inc)

alz_inc_long <- alz_inc_df %>%
  pivot_longer(
    # 1️⃣ Seleziona tutte le colonne che iniziano con cdrsb, abpet o taupet,
    #     seguite da un numero (0–6)
    cols = matches("^(bprs|cdrsb|abpet|taupet|bprsinc|cdrsbinc|abpetinc|taupetinc)\\d+$"),
    
    # 2️⃣ Crea due nuove colonne:
    #     - ".value" → il prefisso (cdrsb, abpet, taupet)
    #     - "year"   → il numero alla fine
    names_to = c(".value", "year"),
    
    # 3️⃣ Divide i nomi in due parti: (prefisso, numero)
    names_pattern = "(bprs|cdrsb|abpet|taupet|bprsinc|cdrsbinc|abpetinc|taupetinc)(\\d+)"
  ) %>%
  mutate(
    year = as.numeric(year),                            # converte in numerico
    sample = factor(rep(1:nrow(alz_inc_df), each = 7)) # ID per ogni paziente
  )
```

Now we can work a little bit on the results.

```{r increments results}
## General behavior

ggplot(alz_inc_long, aes(x = year, y = bprsinc)) +
  stat_summary(fun = mean, geom = "line", size = 1) +
  stat_summary(fun.data = mean_sdl, geom = "ribbon", fun.args = list(mult = 1),
               alpha = 0.2, fill = "lightblue") +
  theme_minimal() +
  labs(title = "General mean behavior")

ggplot(alz_inc_long, aes(x = year, y = bprsinc, group = sex, color = sex)) +
  stat_summary(fun = mean, geom = "line", size = 1) +
  stat_summary(fun.data = mean_sdl, geom = "ribbon", fun.args = list(mult = 1),
               alpha = 0.2, fill = "lightblue") +
  theme_minimal() +
  labs(title = "General mean behavior wrt sex")

ggplot(alz_inc_long, aes(x = year, y = bprsinc, group = age, color = age)) +
  stat_summary(fun = mean, geom = "line", size = 1) +
  #stat_summary(fun.data = mean_sdl, geom = "ribbon", fun.args = list(mult = 1),
  #             alpha = 0.2, fill = "lightblue") +
  theme_minimal() +
  labs(title = "General mean behavior wrt age")

ggplot(alz_inc_long, aes(x = year, y = bprsinc, group = edu, color = edu)) +
  stat_summary(fun = mean, geom = "line", size = 1) +
  #stat_summary(fun.data = mean_sdl, geom = "ribbon", fun.args = list(mult = 1),
  #             alpha = 0.2, fill = "lightblue") +
  theme_minimal() +
  labs(title = "General mean behavior wrt edu")

ggplot(alz_inc_long, aes(x = year, y = bprsinc, group = wzc, color = wzc)) +
  stat_summary(fun = mean, geom = "line", size = 1) +
  stat_summary(fun.data = mean_sdl, geom = "ribbon", fun.args = list(mult = 1),
               alpha = 0.2, fill = "lightblue") +
  theme_minimal() +
  labs(title = "General mean behavior wrt wzc")

```

_Complete any combination..._

It seems that the slopes are the same for any group: this is coherent with our previous conclusions!!



# Multivariate model

We export the data in a format that SAS can read.

```{r}
write_sas(alz_long,
          "alz25long.sas7bdat")
```


